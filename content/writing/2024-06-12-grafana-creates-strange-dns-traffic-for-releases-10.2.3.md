+++
title = "Grafana creates strange DNS traffic for releases >= 10.2.3"
date = "2024-06-16"
url = "/grafana-dns"
aliases = [ "/writing/2024/06/16/grafana-creates-strange-dns-traffic-for-releases-10.2.3/" ]
recommended = "false"
+++

*Edit: This is **resolved** and nothing malicious is happening.
See [here](https://github.com/grafana/grafana/issues/88951#issuecomment-2172781991)
for the GitHub issue update. The issue here appears to be the result of Safari
pre-fetching DNS for Grafana's forums, which are linked on the Grafana
landing page and do use advertising scripts.*

I use [AdGuard Home](https://adguard.com/en/adguard-home/overview.html)
for DNS-based ad-blocking and recently noticed some suspicious looking
traffic getting consistently blocked in my DNS query logs. Lots of outbound
queries to fishy Russian and Greek ad servers (see the
[full list](#queried-domains) below):

{{< picture-embed src="/2024-06-16-adguard.png" alt="DNS requests in AdGuard Home" width="800" height="380">}}

After some investigating, I found that these requests were generated by
[Grafana](https://grafana.com), which is visualization software I use to
monitor server health. Specifically, the requests are generated *only*
by desktop Safari clients that load any local Grafana page from Docker image
`10.2.3` or above (including `latest` at the time of this posting). Some
details:

- The requests are triggered by a refresh (clicking in the UI does not trigger them).
- All Safari extensions are disabled.
- Safari version 17.4.1, macOS version 14.4.1.
- Safari iOS clients do not produce the requests.
- Chromium and Firefox do not produce the requests.
- Grafana has no plugins installed.
- Provisioning from YAML on a fresh image does not solve the issue.
- `tcpdump` confirms these are client-side DNS requests coming from my MacBook.
- Docker images 10.2.2 and below do not produce the unusual requests, they
  *only* perform DNS queries for grafana.com.

I confirmed these results using an entirely separate MacBook client, and
they've also been confirmed independently [on reddit](https://old.reddit.com/r/homelab/comments/1dfdln5/grafana_creates_strange_dns_traffic_for_releases/l8t95vd/).
I reached out to the Grafana security team on April 3rd and again on April 8th,
but received no response. I also created a [GitHub issue](https://github.com/grafana/grafana/issues/88951).

I'm not qualified to speculate about the implications here, security or
otherwise, but I do hope someone looks into this more. Even if the behavior
isn't malicious, it's still incredibly strange. Crossing my fingers
that this is a misconfiguration and not something worse, like a
supply chain attack or the start of ads in Grafana.

ðŸ¤ž

---

## Queried domains

This is the full list of domains queried when refreshing a page. The list seems
to be static as it hasn't changed between `10.2.3` and `latest`, as far as I
can tell.

- ad.letmeads.com
- ad.planbplus.co.kr
- ad2.trafficgate.net
- adserv.ontek.com.tr
- adserver.html.it
- adv.imadrep.co.kr
- advmanager.techfun.pl
- affiliazioniads.snai.it
- afftrk.altex.ro
- app.readpeak.com
- axiabanners.exodus.gr
- bd742.com
- blackfridaysales.ro
- click.hotlog.ru
- event.2performant.com
- febrare.ru
- g1.v.fwmrm.net
- hitcounter.ru
- interactive.forthnet.gr
- izlenzi.com
- l.profitshare.ro
- pay4results24.eu
- promo.vador.com
- telegram.me
- top.mail.ru
- utimg.ru
- www.installads.net
- www.salidzini.lv
- www.stumbleupon.com
- www.trizer.pl
- xltube.nl
