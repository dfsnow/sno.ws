{{ define "additional-style" }}
{{ with resources.Get "css/photos-list.css" | toCSS | minify | fingerprint}}
    <style media="screen">{{ .Content | safeCSS }}</style>
{{ end }}
{{ end }}

{{ define "main" }}
<div class="post-list-photos">
    {{ range where $.Site.RegularPages "Section" "photos" }}

	<!-- Get image base path and type -->
	{{ $srcBase := .Site.Params.photosURL }}
	{{ $srcFileFull := print $srcBase "/resized/" (index (findRE "^([^.]+)" .Params.src 1) 0) }}
	{{ $srcExt := index (findRE "\\.[^.]*$|$" .Params.src 1) 0 }}
	{{ $srcType := replaceRE ".jpg" "jpeg" $srcExt | replaceRE "\\." "" }}

	<!-- Get explicit width and height to include in img tag -->
	{{ $srcWidth := .Params.width }}
	{{ $srcHeight := .Params.height }}
	{{ $srcCalcWidth := print "calc(" $srcWidth "px * 400/" $srcHeight ")" | safeCSS }}

	<figure class="photo-frame" style="width:{{ $srcCalcWidth }};">
	    <a href="{{ .RelPermalink }}">
		<picture>
		    <source srcset="{{ $srcFileFull }}-640.avif 640w" sizes="100vw" type="image/avif">
		    <source srcset="{{ $srcFileFull }}-640.webp 640w" sizes="100vw" type="image/webp">
		    <source srcset="{{ $srcFileFull }}-640{{ $srcExt }} 640w" sizes="100vw" type="image/{{ $srcType }}">
		    <img src="{{ $srcFileFull }}-640{{ $srcExt }}" alt="{{ .Title }}" width="{{ $srcWidth }}" height="{{ $srcHeight }}" loading="lazy">
		</picture>
	    </a>
	    {{ if eq .Params.recommended "true" }}
		<figcaption class="photo-rec">
		    <a href="/hearts-and-ratings" class="link-fave-heart" title="Personal favorite">
		    <svg aria-label="Personal favorite" role="img" viewBox="0 0 32 32" width="24px" height="24px">
			<title>Personal favorite</title>
			<path d="M4 16c-3-4-2-10 3-12 5-2 8 2 9 4 1-2 5-6 10-4 5 2 5 8 2 12-3 4-12 12-12 12 0 0-9-8-12-12z"/>
		    </svg>
		    </a>
		</figcaption>
	    {{ end }}
	</figure>
    {{ end }}
</div>
{{ end }}
